<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>KISDigital - Using ColdFusion to read OpenGraph and Twitter Metadata</title>
	<meta name="description" content="ColdFusion, ColdBox, CommandBox and other assorted musings">
	<meta name="author" content="Robert Zehnder">
	<meta name="twitter:widgets:theme" content="light">
	<meta name="twitter:widgets:border-color" content="#55acee">
			<meta property="og:title" content="Using ColdFusion to read OpenGraph and Twitter Metadata" />
			<meta property="og:description" content="Fun with metadata" />
			<meta property="og:image" content="https://static.kisdigital.com/images/opengraph/photo-1495020689067-958852a7765e.jpeg" />
			<meta name="twitter:card" content="summary_large_image" />
			<meta name="twitter:title" content="Using ColdFusion to read OpenGraph and Twitter Metadata" />
			<meta name="twitter:description" content="Fun with metadata" />
			<meta name="twitter:image" content="https://static.kisdigital.com/images/opengraph/photo-1495020689067-958852a7765e.jpeg" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-one-dark.min.css" integrity="sha512-c6S8OdtvoqZCbMfA1lWE0qd368pLdFvVHVILQzNizfowC+zV8rmVKdSlmL5SuidvATO0A7awDg53axd+s/9amw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="/assets/css/site.css?v=1703257225189">
</head>
<body style="padding-top: 70px;">
	<header>
		<nav class="header">
			<div class="container">
				<div class="row">
					<div class="col-2">
						<a class="site-link" href="/"><span style="color: var(--post-link-text)">KIS</span>Digital</a>
					</div>
					<div class="col-10"></div>
				</div>
			</div>
		</nav>
	</header>
	<div class="container text-white">
<div class="row">
	<div class="col-lg-8 col-md-12">
		<div class="card rf-card-bordered">
			<div class="card-body">
				<div style="background: url(https://static.kisdigital.com/images/opengraph/photo-1495020689067-958852a7765e.jpeg) no-repeat center center; background-size: cover; height: 350px;">
					<div class="bg-dark w-75 opacity-75 p-2">
						<p class="h2 text-white">Using ColdFusion to read OpenGraph and Twitter Metadata</p>
						<small class="d-block text-white py-1">Fun with metadata</small>
							<span class="badge bg-light m-1 p-2 h5 text-dark">cfml</span>
						<p class="text-white small text-uppercase">
							June 3, 2020 /
							Robert Zehnder
						</p>
					</div>
				</div>
				<div class="my-3">
					<a href="https://www.facebook.com/sharer/sharer.php?u=https://kisdigital.com/posts/2020/using-coldfusion-to-read-opengraph-and-twitter-metadata" class="text-decoration-none" target="_blank">
						<i class="bi bi-facebook px-1 text-white fs-5"></i>
					</a>
					<a href="https://www.twitter.com/share?url=https://kisdigital.com/posts/2020/using-coldfusion-to-read-opengraph-and-twitter-metadata" class="text-decoration-none" target="_blank">
						<i class="bi bi-twitter px-1 text-white fs-5"></i>
					</a>
					<a href="https://www.linkedin.com/sharing/share-offsite/?url=https://kisdigital.com/posts/2020/using-coldfusion-to-read-opengraph-and-twitter-metadata" class="text-decoration-none" target="_blank">
						<i class="bi bi-linkedin px-1 text-white fs-5"></i>
					</a>
				</div>
				<div class="my-3 text-white post decorate-links">
					<p>Honestly, John Krasinski was ahead of the curve when he started his web series, Some Good News. Which got me thinking that there really is not a place to find good news. Reading through the feed on any given day and you can easily understand why Facebook decided to pay out $52 million dollars to its moderators as compensation for mental health issues.</p>
<p>I thought it might be a fun little exercise to create a page where I could enter a URL, use <code>cfhttp</code> to read the meta data from the page, and have a tiled display of all the articles. I will be using ColdBox to get up to speed quickly and since this will not be a production application it may not have a lot of polish, but it will work. Once the application has been scaffolded it is time for the fun stuff. It is definitely possible to grab the page contents and try to pull the meta tags out with regex, but I will be using the cbjsoup module. The first step is to get it installed by dropping to the command line and install with <code>box install cbjsoup</code>. That done, lets get the spider service written.</p>
<pre><code class="language-javascript">component {
 // SpiderService.cfc
 property name=&quot;jSoup&quot; inject=&quot;javaLoader:org.jsoup.Jsoup&quot;;
 function spider(required string linkUrl) {
 var meta = {};
 cfhttp(url = linkUrl);
 var jsDoc = jSoup.parse(cfhttp.fileContent);
 var el = jsDoc.select(&quot;meta&quot;);
 var filtered = el.filter(function(its){
 return
 its.attr(&quot;name&quot;).find(&quot;twitter:&quot;) ||
 its.attr(&quot;name&quot;).find(&quot;og:&quot;) ||
 its.attr(&quot;property&quot;).find(&quot;twitter:&quot;) ||
 its.attr(&quot;property&quot;).find(&quot;og:&quot;);
 });
 filtered.each(function(i){
 len(i.attr(&quot;name&quot;)) ? meta[i.attr(&quot;name&quot;)] = i.attr(&quot;content&quot;) : meta[i.attr(&quot;property&quot;)] = i.attr(&quot;content&quot;);
 });
 return meta;
 }
}
</code></pre>
<p>The service itself is simple and contains only one method, spider, which takes an URL as a parameter. Using cfhttp I read in the contents of the web page, use jSoup to filter the meta tags, and filter the meta tags that have either twitter: or og: as part of the name or property attribute. Finally the keys that were found are compiled and returned as a structure.</p>
<p>Next it is time to configure the ColdBox handlers that will call the SpiderService. The first handler I created is spider that will call the service and just dump the values out on the screen which can be useful for debugging. Next is the feed handler that will handle the tiled display of stories.</p>
<pre><code class="language-javascript">component extends=&quot;coldbox.system.EventHandler&quot; {
 property name=&quot;SpiderService&quot; inject=&quot;model&quot;;
 function index (event, rc, prc) {
 event.setView('demos/index');
 }
 function spider (event, rc, prc) {
 prc['url'] = event.getValue(&quot;url&quot;, &quot;&quot;);
 prc['data'] = {};
 if (prc.url.len()) {
 prc.data.append(SpiderService.spider(linkUrl = prc.url));
 }
 event.setView('demos/spider');
 }
 function feed (event, rc, prc) {
 if(!application.keyExists(&quot;feed&quot;)) application['feed'] = [];
 prc['feed'] = [];
 prc['url'] = event.getValue(&quot;url&quot;, &quot;&quot;);
 if (prc.url.len()) {
 var meta = SpiderService.spider(linkUrl = prc.url);
 var tmp = {
 'title': meta.keyExists(&quot;twitter:title&quot;) ? meta['twitter:title'] : meta['og:title'],
 'description': meta.keyExists(&quot;twitter:description&quot;) ? meta['twitter:description'] : meta['og:description'],
 'image': meta.keyExists(&quot;twitter:img:src&quot;) ? meta['twitter:img:src'] : meta['og:image'],
 'url': meta.keyExists(&quot;twitter:url&quot;) ? meta['twitter:url'] : meta['og:url']
 };
 var exists = application.feed.filter(function(i){
 return i.url == tmp.url;
 }).len() ? true : false;
 if(!exists) application.feed.append(tmp);
 }
 prc.feed.append(application.feed, true);
 event.setView('demos/feed');
 }
}
</code></pre>
<p><img src="https://static.kisdigital.com/images/opengraph/01_meta.png" alt="Meta" /></p>
<p>The spider handler is really simple; it makes a call to the spider service and will dump any meta data it finds for the url, if any.</p>
<p><img src="https://static.kisdigital.com/images/opengraph/02_feed.png" alt="Feed" /></p>
<p>The feed handler builds off the spider handler. The results from the spider service are saved in the meta structure. Next a temporary structure stores the four main values needed for the tiled screen: title, description, image, and url. This code prefers to use the twitter meta if it exists, if not, fall back to the opengraph meta. Finally check to see if the item already exists in the application's feed array to prevent duplicate items.</p>
<p>Originally I was going to add this feature to a website I was working on, but that has fallen by the wayside. Still, I thought someone might find it interesting. If you would like to follow along at home the link to the repo is below, just follow the instructions in the readme.</p>
<p>Enjoy!</p>
				</div>
<div id="disqus_thread"></div>
<script>
	/**
	 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
	 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
	var disqus_config = function () {
		this.page.url = "https://kisdigital.com/posts/2020/using-coldfusion-to-read-opengraph-and-twitter-metadata";
		this.page.identifier = "/posts/2020/using-coldfusion-to-read-opengraph-and-twitter-metadata"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
	};
	(function() { // DON'T EDIT BELOW THIS LINE
		var d = document, s = d.createElement('script');
		s.src = 'https://kisdigital.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			</div>
		</div>
	</div>
	<div class="col-lg-4 d-none d-lg-block d-xl-block">
<div>
	<div class="card rf-card-bordered text-white">
		<div class="card-body">
			<div class="card-title">
				<span class="h6"><span style="color: var(--post-link-text)">KIS</span>Digital</span>
			</div>
			<div class="card-text">
				<small>
					ColdFusion, ColdBox, CommandBox and assorted musings.
				</small>
			</div>
		</div>
	</div>
	<div class="card rf-card-bordered text-white mt-3">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">Tags</span>
			</div>
			<div class="card-text">
					<a href="/tag/cfml"> <span class="h5"><span class="badge bg-info text-muted p-2">cfml</span></span></a>
					<a href="/tag/commandbox"> <span class="h5"><span class="badge bg-info text-muted p-2">commandbox</span></span></a>
					<a href="/tag/misc"> <span class="h5"><span class="badge bg-info text-muted p-2">misc</span></span></a>
					<a href="/tag/sql"> <span class="h5"><span class="badge bg-info text-muted p-2">sql</span></span></a>
			</div>
		</div>
	</div>
	<div class="card rf-card-bordered text-white mt-3">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">Recent Posts</span>
			</div>
			<div class="card-text">
					<a href="/posts/2023/commandbox-ssg-updates" class="post-link text-decoration-none">Commandbox-ssg updates</a><br />
					<a href="/posts/2023/an-introduction-to-commandbox-ssg" class="post-link text-decoration-none">An introduction to commandbox-ssg</a><br />
					<a href="/posts/2023/bringing-back-commandbox-ssg" class="post-link text-decoration-none">Bringing back commandbox-ssg</a><br />
					<a href="/posts/2023/introducing-commandbox-apiman" class="post-link text-decoration-none">Introducing commandbox-apiman</a><br />
					<a href="/posts/2022/generating-common-blog-files-with-jasper" class="post-link text-decoration-none">Generating common blog files with Jasper</a><br />
			</div>
		</div>
	</div>
	<div class="card rf-card-bordered text-white mt-3">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">Projects</span>
			</div>
			<div class="card-text">
					<a href="/projects/commandbox-apiman" class="post-link text-decoration-none">commandbox-apiman</a><br />
					<a href="/projects/commandbox-ssg" class="post-link text-decoration-none">commandbox-ssg</a><br />
			</div>
		</div>
	</div>
</div>
	</div>
</div>
	</div>
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
	<script type="text/javascript" src="//cdn.jsdelivr.net/gh/dkern/jquery.lazy@1.7.10/jquery.lazy.min.js"></script>
	<script type="text/javascript" src="//cdn.jsdelivr.net/gh/dkern/jquery.lazy@1.7.10/jquery.lazy.plugins.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js" integrity="sha512-YBk7HhgDZvBxmtOfUdvX0z8IH2d10Hp3aEygaMNhtF8fSOvBZ16D/1bXZTJV6ndk/L/DlXxYStP8jrF77v2MIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="/assets/js/global.js?v=1703257225189"></script>
	<script>
		$(function($) {
			$('.lazy img').lazy()
		})
	</script>
</body>
</html>