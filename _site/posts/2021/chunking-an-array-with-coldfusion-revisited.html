<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>KISDigital - Chunking an Array with ColdFusion Revisited</title>
	<meta name="description" content="ColdFusion, ColdBox, CommandBox and other assorted musings">
	<meta name="author" content="Robert Zehnder">
	<meta name="twitter:widgets:theme" content="light">
	<meta name="twitter:widgets:border-color" content="#55acee">
			<meta property="og:title" content="Chunking an Array with ColdFusion Revisited" />
			<meta property="og:description" content="Revisiting chunking ColdFusion arrays" />
			<meta property="og:image" content="https://static.kisdigital.com/images/chunking-an-array-with-coldfusion-revisited/00_cover.jpeg" />
			<meta name="twitter:card" content="summary_large_image" />
			<meta name="twitter:title" content="Chunking an Array with ColdFusion Revisited" />
			<meta name="twitter:description" content="Revisiting chunking ColdFusion arrays" />
			<meta name="twitter:image" content="https://static.kisdigital.com/images/chunking-an-array-with-coldfusion-revisited/00_cover.jpeg" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-one-dark.min.css" integrity="sha512-c6S8OdtvoqZCbMfA1lWE0qd368pLdFvVHVILQzNizfowC+zV8rmVKdSlmL5SuidvATO0A7awDg53axd+s/9amw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="/assets/css/site.css?v=1703108634386">
</head>
<body style="padding-top: 70px;">
	<header>
		<nav class="header">
			<div class="container">
				<div class="row">
					<div class="col-2">
						<a class="site-link" href="/"><span style="color: var(--post-link-text)">KIS</span>Digital</a>
					</div>
					<div class="col-10"></div>
				</div>
			</div>
		</nav>
	</header>
	<div class="container text-white">
<div class="row">
	<div class="col-lg-8 col-md-12">
		<div class="card rf-card-bordered">
			<div class="card-body">
				<div style="background: url(https://static.kisdigital.com/images/chunking-an-array-with-coldfusion-revisited/00_cover.jpeg) no-repeat center center; background-size: cover; height: 350px;">
					<div class="bg-dark w-75 opacity-75 p-2">
						<p class="h2 text-white">Chunking an Array with ColdFusion Revisited</p>
						<small class="d-block text-white py-1">Revisiting chunking ColdFusion arrays</small>
							<span class="badge bg-light m-1 p-2 h5 text-dark">cfml</span>
						<p class="text-white small text-uppercase">
							January 3, 2021 /
							Robert Zehnder
						</p>
					</div>
				</div>
				<div class="my-3">
					<a href="https://www.facebook.com/sharer/sharer.php?u=https://kisdigital.com/posts/2021/chunking-an-array-with-coldfusion-revisited" class="text-decoration-none" target="_blank">
						<i class="bi bi-facebook px-1 text-white fs-5"></i>
					</a>
					<a href="https://www.twitter.com/share?url=https://kisdigital.com/posts/2021/chunking-an-array-with-coldfusion-revisited" class="text-decoration-none" target="_blank">
						<i class="bi bi-twitter px-1 text-white fs-5"></i>
					</a>
					<a href="https://www.linkedin.com/sharing/share-offsite/?url=https://kisdigital.com/posts/2021/chunking-an-array-with-coldfusion-revisited" class="text-decoration-none" target="_blank">
						<i class="bi bi-linkedin px-1 text-white fs-5"></i>
					</a>
				</div>
				<div class="my-3 text-white decorate-links post">
					<p>A few months ago I wrote a blog post about chunking an array with ColdFusion. This is a feature that is handy when you need to update hundreds of products in an API call, but they only allow you to update four products at a time. The product data can be added to one large array, the chunk method is called and an array of smaller arrays is returned.</p>
<p>I was able to come up with a method that worked, my project deployed, I blogged about it, and finally forgot about it.</p>
<h4>A Chance Conversation</h4>
<p>I love learning new things. The thing about working in technology is it is always evolving so if you are not always learning you are going to be left behind. It is not a matter of if, it is a matter of when. I happened to strike up a conversation with a friend and he asked how I would solve a particular programming problem. Once I answered he said, &quot;Wow, so you do not have a background in computer science?&quot;</p>
<p>I am not going to lie, that was an eye opener for me. I have always been able to look at almost any problem, break it down to manageable bits, and come up with a solution. This time, my solution elicited that reaction.</p>
<p>I did eventually solve the issue, but it also gave me the gentle nudge I needed to do some reading on the basics of computer science and design patterns. It is always better to work smarter, not necessarily harder.</p>
<p>Which brings us back to the title of this post, revisiting chunking arrays with ColdFusion. Here is the code from the original post:</p>
<pre><code class="language-javascript">// given an array, return an array of arrays with {{chunkSize}} elements
function chunk (required array input, required numeric chunkSize) {
 var output[1] = [];
 var currentChunk = 1;
 input.each((item, index) =&gt; {
  output[currentChunk].append(item);
  if(index % chunkSize == 0 &amp;&amp; index &lt; input.len()) output[++currentChunk] = [];
 })
 return output;
}
</code></pre>
<p>The code is straight forward. The chunk method takes two inputs, the array you would like to chunk and the size you would like those chunks to be. It iterates over every element of the array creating a new array element when needed. I was pleased with myself when I wrote it because the code looks very clever.</p>
<p>After my conversation though, that little bit of code has been stuck in my head. It is reasonably fast with 100 elements, but what about 1,000 or 100,000? Every time the array grows the amount of processing grows at a 1:1 ratio.</p>
<p>There has to be a better solution. After a little thought, this is what I came up with:</p>
<pre><code class="language-javascript">function chunk(arr, sz) {
 var out = [];
 for(var i = 1; i &lt;= ceiling(arr.len() / sz); i++) out.append(i == ceiling(arr.len() / sz) ? arr.slice(1 + (i - 1) * sz, arr.len() - ((i - 1) * sz)) : arr.slice(1 + (i - 1) * sz, sz));
 return out;
}
</code></pre>
<p>It is still some very clever looking code, but it also efficient. Given an array with x elements and I want to divide it in to chunks of y size, I only need to iterate through the array ceiling(x / y) times. Leveraging slice, I can calculate the starting position and the number of elements to take each iteration. If it is the last iteration if the chunk size is greater than the length of the array it just takes whatever is left. The code looks complicated, but it is actually simple.</p>
<h4>Closing Thoughts</h4>
<p>I suppose I owe my friend a debt of gratitude for that conversation. I will be the first to admit I was embarrassed by his reaction, but it was the push I needed. I have ordered some books on basic computer science concepts and design patterns; things that will make me a better coder. I have a few friends much smarter than me I can reach out to when needed, so overall I am blessed.</p>
<p>The closing thought on my original post was &quot;Is there a more efficient way of handling this?&quot; I suppose I answered my own question.</p>
<p>Edit 4/14/2021
After posting this I decided to run the two methods head-to-head against a large array to see the change in performance. I created an array with 100,000 elements and ran both methods, the original method was actually consistently faster no matter the size of the dataset. I will try putzing around with the new method to try and find the bottleneck.</p>
				</div>
<div id="disqus_thread"></div>
<script>
	/**
	 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
	 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
	var disqus_config = function () {
		this.page.url = "https://kisdigital.com/posts/2021/chunking-an-array-with-coldfusion-revisited";
		this.page.identifier = "/posts/2021/chunking-an-array-with-coldfusion-revisited"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
	};
	(function() { // DON'T EDIT BELOW THIS LINE
		var d = document, s = d.createElement('script');
		s.src = 'https://kisdigital.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			</div>
		</div>
	</div>
	<div class="col-lg-4 d-none d-lg-block d-xl-block">
<div>
	<div class="card rf-card-bordered text-white">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">KISDigital</span>
			</div>
			<div class="card-text">
				<small>
					ColdFusion, ColdBox, CommandBox and assorted musings.
				</small>
			</div>
		</div>
	</div>
	<div class="card rf-card-bordered text-white mt-3">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">Tags</span>
			</div>
			<div class="card-text">
					<a href="/tag/misc"> <span class="h5"><span class="badge bg-info text-muted p-2">misc</span></span></a>
					<a href="/tag/cfml"> <span class="h5"><span class="badge bg-info text-muted p-2">cfml</span></span></a>
					<a href="/tag/commandbox"> <span class="h5"><span class="badge bg-info text-muted p-2">commandbox</span></span></a>
					<a href="/tag/sql"> <span class="h5"><span class="badge bg-info text-muted p-2">sql</span></span></a>
			</div>
		</div>
	</div>
	<div class="card rf-card-bordered text-white mt-3">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">Recent Posts</span>
			</div>
			<div class="card-text">
					<a href="/posts/2023/merry-christmas-and-happy-new-year" class="post-link text-decoration-none">Wishing you a Merry Christmas</a><br />
					<a href="/posts/2023/commandbox-ssg-updates" class="post-link text-decoration-none">Commandbox-ssg updates</a><br />
					<a href="/posts/2023/an-introduction-to-commandbox-ssg" class="post-link text-decoration-none">An introduction to commandbox-ssg</a><br />
					<a href="/posts/2023/bringing-back-commandbox-ssg" class="post-link text-decoration-none">Bringing back commandbox-ssg</a><br />
					<a href="/posts/2023/introducing-commandbox-apiman" class="post-link text-decoration-none">Introducing commandbox-apiman</a><br />
			</div>
		</div>
	</div>
</div>
	</div>
</div>
	</div>
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
	<script type="text/javascript" src="//cdn.jsdelivr.net/gh/dkern/jquery.lazy@1.7.10/jquery.lazy.min.js"></script>
	<script type="text/javascript" src="//cdn.jsdelivr.net/gh/dkern/jquery.lazy@1.7.10/jquery.lazy.plugins.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js" integrity="sha512-YBk7HhgDZvBxmtOfUdvX0z8IH2d10Hp3aEygaMNhtF8fSOvBZ16D/1bXZTJV6ndk/L/DlXxYStP8jrF77v2MIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="/assets/js/global.js?v=1703108634386"></script>
	<script>
		$(function($) {
			$('.lazy img').lazy()
		})
	</script>
</body>
</html>