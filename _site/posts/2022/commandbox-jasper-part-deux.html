<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>KISDigital - Commandbox-jasper Part Deux</title>
	<meta name="description" content="ColdFusion, ColdBox, CommandBox and other assorted musings">
	<meta name="author" content="Robert Zehnder">
	<meta name="twitter:widgets:theme" content="light">
	<meta name="twitter:widgets:border-color" content="#55acee">
			<meta property="og:title" content="Commandbox-jasper Part Deux" />
			<meta property="og:description" content="Continuing development on commandbox-jasper" />
			<meta property="og:image" content="https://static.kisdigital.com/images/2022/07/jasper-part-two-00.jpg" />
			<meta name="twitter:card" content="summary_large_image" />
			<meta name="twitter:title" content="Commandbox-jasper Part Deux" />
			<meta name="twitter:description" content="Continuing development on commandbox-jasper" />
			<meta name="twitter:image" content="https://static.kisdigital.com/images/2022/07/jasper-part-two-00.jpg" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-one-dark.min.css" integrity="sha512-c6S8OdtvoqZCbMfA1lWE0qd368pLdFvVHVILQzNizfowC+zV8rmVKdSlmL5SuidvATO0A7awDg53axd+s/9amw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="/assets/css/site.css?v=1703108634386">
</head>
<body style="padding-top: 70px;">
	<header>
		<nav class="header">
			<div class="container">
				<div class="row">
					<div class="col-2">
						<a class="site-link" href="/"><span style="color: var(--post-link-text)">KIS</span>Digital</a>
					</div>
					<div class="col-10"></div>
				</div>
			</div>
		</nav>
	</header>
	<div class="container text-white">
<div class="row">
	<div class="col-lg-8 col-md-12">
		<div class="card rf-card-bordered">
			<div class="card-body">
				<div style="background: url(https://static.kisdigital.com/images/2022/07/jasper-part-two-00.jpg) no-repeat center center; background-size: cover; height: 350px;">
					<div class="bg-dark w-75 opacity-75 p-2">
						<p class="h2 text-white">Commandbox-jasper Part Deux</p>
						<small class="d-block text-white py-1">Continuing development on commandbox-jasper</small>
							<span class="badge bg-light m-1 p-2 h5 text-dark">cfml</span>
							<span class="badge bg-light m-1 p-2 h5 text-dark">commandbox</span>
						<p class="text-white small text-uppercase">
							July 5, 2022 /
							Robert Zehnder
						</p>
					</div>
				</div>
				<div class="my-3">
					<a href="https://www.facebook.com/sharer/sharer.php?u=https://kisdigital.com/posts/2022/commandbox-jasper-part-deux" class="text-decoration-none" target="_blank">
						<i class="bi bi-facebook px-1 text-white fs-5"></i>
					</a>
					<a href="https://www.twitter.com/share?url=https://kisdigital.com/posts/2022/commandbox-jasper-part-deux" class="text-decoration-none" target="_blank">
						<i class="bi bi-twitter px-1 text-white fs-5"></i>
					</a>
					<a href="https://www.linkedin.com/sharing/share-offsite/?url=https://kisdigital.com/posts/2022/commandbox-jasper-part-deux" class="text-decoration-none" target="_blank">
						<i class="bi bi-linkedin px-1 text-white fs-5"></i>
					</a>
				</div>
				<div class="my-3 text-white decorate-links post">
					<p>Photo by <a href="https://unsplash.com/@kaitlynbaker?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Kaitlyn Baker</a> on <a href="https://unsplash.com/s/photos/tech-writing?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a></p>
<p>I just completed the first iteration of commandbox-jasper, a CommandBox module for generating static sites, and showed what I had to my SSG expert. He asked if it could handle any file structure or if it was tied to the blog format.</p>
<p>I was honest, &quot;Yeah, you are kind of locked in the the blog format at the moment.&quot;</p>
<p>He suggested I take a look at how <a href="https://www.11ty.dev">11ty</a> handles things and try to emulate what they do. That is just what I did.</p>
<h3>the blog scaffold</h3>
<p>I started cleaning <a href="https://github.com/robertz/jasper-cli">jasper-cli</a>. The <a href="https://github.com/11ty/eleventy-base-blog">eleveny-base-blog</a> seemed like a great place to start so I began reorganizing jasper's directory structure.</p>
<p>The <code>jasperconfig.json</code> file has been moved into the <code>_data</code> folder. Any data files generated by the build process will also be stored here.</p>
<p>The <code>assets/</code> folder in the root will be copied to the <code>_site</code> folder at build, but that functionality has not been added yet.</p>
<p>The ColdFusion files used to generate the static content have been moved to the <code>_includes</code> directory. I have a very basic layout/view system working with Jasper. If no layout is specified it will default to the <code>main</code> layout.</p>
<p>It is now also possible to use CFML files as templates. You can specify front matter in a CFML file by adding a ColdFusion comment on the first line of the file. The front matter values will be available in the <code>prc</code> scope on the page. Here is an example adding setting YAML in a ColdFusion comment.</p>
<pre><code class="language-html">&lt;!---
layout: main
something: else
weird:
- an
- array
- of
- stuff
---&gt;
&lt;cfoutput&gt;
&lt;div class=&quot;container&quot;&gt;
 &lt;cfloop array=&quot;#prc.posts#&quot; index=&quot;i&quot;&gt;
  &lt;a href=&quot;/posts/#i.slug#&quot;&gt;#i.title#&lt;/a&gt;&lt;br /&gt;
 &lt;/cfloop&gt;
&lt;/div&gt;
&lt;cfdump var=&quot;#prc#&quot; /&gt;
&lt;/cfoutput&gt;
</code></pre>
<p>Here we can see the results.
<img src="https://static.kisdigital.com/images/2022/07/jasper-part-two-01.jpg" alt="dump" /></p>
<h3>jasper rendering</h3>
<p>There are two markdown files in the <code>posts/</code> folder to getting started, but the new <code>jasper build</code> looks for any valid template in the root directory and subdirectories (currently <em>.md and</em>.cfm files), attempts to read the front matter from each file, and write the HTML to disk. Special directorys such as <code>_data</code> and <code>_includes</code> are ignored.</p>
<pre><code class="language-javascript">component extends=&quot;commandbox.system.BaseCommand&quot; {
 property name=&quot;JasperService&quot; inject=&quot;JasperService@commandbox-jasper&quot;;
 function run() {
  command( &quot;jasper cache build&quot; ).run();
  var conf  = deserializeJSON( fileRead( resolvePath( &quot;_data/jasperconfig.json&quot; ), &quot;utf-8&quot; ) );
  var posts = deserializeJSON( fileRead( resolvePath( &quot;_data/post-cache.json&quot; ), &quot;utf-8&quot; ) );
  var tags  = JasperService.getTags( posts );
  var rootDir = resolvePath( &quot;.&quot; );
  rootDir     = left( rootDir, len( rootDir ) - 1 )
  print.line( &quot;Building source directory: &quot; &amp; rootDir );
  var templateList = JasperService.list( rootDir );
  templateList.each( ( template ) =&gt; {
   var fragment     = &quot;&quot;;
   var content      = &quot;&quot;;
   var renderedHTML = &quot;&quot;;
   var isCFM        = template.name.findNoCase( &quot;.cfm&quot; ) ? true : false;
   var prc          = {
    &quot;meta&quot;     : {},
    &quot;content&quot;  : &quot;&quot;,
    &quot;tagCloud&quot; : tags,
    &quot;type&quot;     : &quot;page&quot;,
    &quot;posts&quot;    : posts
   };
   prc.append( conf );
   // Try reading the front matter from the template
   prc.append( JasperService.getPostData( fname = template.directory &amp; &quot;/&quot; &amp; template.name ) );
   // render the view
   if ( prc.keyExists( &quot;type&quot; ) &amp;&amp; prc.type == &quot;page&quot; ) {
    if ( isCFM ) {
     // we are rending a CFM file, just include it
     savecontent variable=&quot;fragment&quot; {
      include resolvePath( template.directory &amp; &quot;/&quot; &amp; template.name );
     }
    } else {
     // use the page template
     savecontent variable=&quot;fragment&quot; {
      include resolvePath( &quot;_includes/page.cfm&quot; );
     }
    }
   } else {
    // use the post template
    savecontent variable=&quot;fragment&quot; {
     include resolvePath( &quot;_includes/post.cfm&quot; );
    }
   }
   // content is referenced in the layout
   content = fragment;
   // render the layout
   savecontent variable=&quot;fragment&quot; {
    include resolvePath( &quot;_includes/layouts/&quot; &amp; prc.layout &amp; &quot;.cfm&quot; );
   }
   // renderedHTML is the combined view and layout
   renderedHTML = fragment;
   // write the rendered HTML to disk
   var computedPath = template.directory.replace( rootDir, &quot;&quot; );
   try {
    directoryCreate( resolvePath( &quot;_site&quot; &amp; computedPath ) );
    print.line( &quot;Creating &quot; &amp; resolvePath( &quot;_site&quot; &amp; computedPath ) );
   } catch ( any e ) {
    // fail
   }
   if ( prc.keyExists( &quot;type&quot; ) &amp;&amp; prc.type == &quot;page&quot; ) {
    fileWrite(
     resolvePath( &quot;_site&quot; &amp; computedPath &amp; &quot;/&quot; &amp; listFirst( template.name, &quot;.&quot; ) &amp; &quot;.html&quot; ),
     renderedHTML
    );
    print.line( &quot;_site&quot; &amp; computedPath &amp; &quot;/&quot; &amp; listFirst( template.name, &quot;.&quot; ) &amp; &quot;.html&quot; );
   } else {
    print.line( &quot;_site&quot; &amp; computedPath &amp; &quot;/&quot; &amp; prc.slug &amp; &quot;.html&quot; );
    fileWrite( resolvePath( &quot;_site&quot; &amp; computedPath &amp; &quot;/&quot; &amp; prc.slug &amp; &quot;.html&quot; ), renderedHTML );
   }
  } );
 }
}
</code></pre>
<p>The <code>jasper builld</code> command has been completely rewritten to support layouts and views, as well as handling <code>*.cfm</code> files.</p>
<p><img src="https://static.kisdigital.com/images/2022/07/jasper-part-two-02.jpg" alt="build" /></p>
<p>The default front matter has changed a bit, <code>layout</code> and <code>type</code> attribute are required since <code>jasper build</code> uses these values. CFM files that are not in the <code>_includes</code> directory should start with a CFML comment and have a layout set. It <strong>should</strong> default to main in the front matter, but it might break stuff if you do not have it for the moment.</p>
<pre><code class="language-md">---
layout: main
type: post
slug: getting-started
title: Getting Started
author: Jasper
description: It is pretty easy to get started with Jasper, here are some steps to help you move forward
tags: 
- Jasper
- Getting Started
image: https://static.kisdigital.com/images/jasper/getting-started-00-cover.jpeg
published: true
publishDate: 2020-05-30
---
</code></pre>
<p>I have really enjoyed working with CommandBox so far, the flexibility is amazing.</p>
				</div>
<div id="disqus_thread"></div>
<script>
	/**
	 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
	 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
	var disqus_config = function () {
		this.page.url = "https://kisdigital.com/posts/2022/commandbox-jasper-part-deux";
		this.page.identifier = "/posts/2022/commandbox-jasper-part-deux"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
	};
	(function() { // DON'T EDIT BELOW THIS LINE
		var d = document, s = d.createElement('script');
		s.src = 'https://kisdigital.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			</div>
		</div>
	</div>
	<div class="col-lg-4 d-none d-lg-block d-xl-block">
<div>
	<div class="card rf-card-bordered text-white">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">KISDigital</span>
			</div>
			<div class="card-text">
				<small>
					ColdFusion, ColdBox, CommandBox and assorted musings.
				</small>
			</div>
		</div>
	</div>
	<div class="card rf-card-bordered text-white mt-3">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">Tags</span>
			</div>
			<div class="card-text">
					<a href="/tag/misc"> <span class="h5"><span class="badge bg-info text-muted p-2">misc</span></span></a>
					<a href="/tag/cfml"> <span class="h5"><span class="badge bg-info text-muted p-2">cfml</span></span></a>
					<a href="/tag/commandbox"> <span class="h5"><span class="badge bg-info text-muted p-2">commandbox</span></span></a>
					<a href="/tag/sql"> <span class="h5"><span class="badge bg-info text-muted p-2">sql</span></span></a>
			</div>
		</div>
	</div>
	<div class="card rf-card-bordered text-white mt-3">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">Recent Posts</span>
			</div>
			<div class="card-text">
					<a href="/posts/2023/merry-christmas-and-happy-new-year" class="post-link text-decoration-none">Wishing you a Merry Christmas</a><br />
					<a href="/posts/2023/commandbox-ssg-updates" class="post-link text-decoration-none">Commandbox-ssg updates</a><br />
					<a href="/posts/2023/an-introduction-to-commandbox-ssg" class="post-link text-decoration-none">An introduction to commandbox-ssg</a><br />
					<a href="/posts/2023/bringing-back-commandbox-ssg" class="post-link text-decoration-none">Bringing back commandbox-ssg</a><br />
					<a href="/posts/2023/introducing-commandbox-apiman" class="post-link text-decoration-none">Introducing commandbox-apiman</a><br />
			</div>
		</div>
	</div>
</div>
	</div>
</div>
	</div>
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
	<script type="text/javascript" src="//cdn.jsdelivr.net/gh/dkern/jquery.lazy@1.7.10/jquery.lazy.min.js"></script>
	<script type="text/javascript" src="//cdn.jsdelivr.net/gh/dkern/jquery.lazy@1.7.10/jquery.lazy.plugins.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js" integrity="sha512-YBk7HhgDZvBxmtOfUdvX0z8IH2d10Hp3aEygaMNhtF8fSOvBZ16D/1bXZTJV6ndk/L/DlXxYStP8jrF77v2MIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="/assets/js/global.js?v=1703108634386"></script>
	<script>
		$(function($) {
			$('.lazy img').lazy()
		})
	</script>
</body>
</html>