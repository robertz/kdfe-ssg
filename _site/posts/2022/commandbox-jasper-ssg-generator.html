<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>KISDigital - Commandbox-jasper SSG generator</title>
	<meta name="description" content="ColdFusion, ColdBox, CommandBox and other assorted musings">
	<meta name="author" content="Robert Zehnder">
	<meta name="twitter:widgets:theme" content="light">
	<meta name="twitter:widgets:border-color" content="#55acee">
			<meta property="og:title" content="Commandbox-jasper SSG generator" />
			<meta property="og:description" content="A static site generator using CommandBox" />
			<meta property="og:image" content="https://static.kisdigital.com/images/2022/07/jasper-00.jpg" />
			<meta name="twitter:card" content="summary_large_image" />
			<meta name="twitter:title" content="Commandbox-jasper SSG generator" />
			<meta name="twitter:description" content="A static site generator using CommandBox" />
			<meta name="twitter:image" content="https://static.kisdigital.com/images/2022/07/jasper-00.jpg" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-one-dark.min.css" integrity="sha512-c6S8OdtvoqZCbMfA1lWE0qd368pLdFvVHVILQzNizfowC+zV8rmVKdSlmL5SuidvATO0A7awDg53axd+s/9amw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="/assets/css/site.css?v=1703257225189">
</head>
<body style="padding-top: 70px;">
	<header>
		<nav class="header">
			<div class="container">
				<div class="row">
					<div class="col-2">
						<a class="site-link" href="/"><span style="color: var(--post-link-text)">KIS</span>Digital</a>
					</div>
					<div class="col-10"></div>
				</div>
			</div>
		</nav>
	</header>
	<div class="container text-white">
<div class="row">
	<div class="col-lg-8 col-md-12">
		<div class="card rf-card-bordered">
			<div class="card-body">
				<div style="background: url(https://static.kisdigital.com/images/2022/07/jasper-00.jpg) no-repeat center center; background-size: cover; height: 350px;">
					<div class="bg-dark w-75 opacity-75 p-2">
						<p class="h2 text-white">Commandbox-jasper SSG generator</p>
						<small class="d-block text-white py-1">A static site generator using CommandBox</small>
							<span class="badge bg-light m-1 p-2 h5 text-dark">cfml</span>
							<span class="badge bg-light m-1 p-2 h5 text-dark">commandbox</span>
						<p class="text-white small text-uppercase">
							July 1, 2022 /
							Robert Zehnder
						</p>
					</div>
				</div>
				<div class="my-3">
					<a href="https://www.facebook.com/sharer/sharer.php?u=https://kisdigital.com/posts/2022/commandbox-jasper-ssg-generator" class="text-decoration-none" target="_blank">
						<i class="bi bi-facebook px-1 text-white fs-5"></i>
					</a>
					<a href="https://www.twitter.com/share?url=https://kisdigital.com/posts/2022/commandbox-jasper-ssg-generator" class="text-decoration-none" target="_blank">
						<i class="bi bi-twitter px-1 text-white fs-5"></i>
					</a>
					<a href="https://www.linkedin.com/sharing/share-offsite/?url=https://kisdigital.com/posts/2022/commandbox-jasper-ssg-generator" class="text-decoration-none" target="_blank">
						<i class="bi bi-linkedin px-1 text-white fs-5"></i>
					</a>
				</div>
				<div class="my-3 text-white post decorate-links">
					<p>Photo by <a href="https://unsplash.com/@patrickian4?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Patrick Fore</a> on <a href="https://unsplash.com/s/photos/writing?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText">Unsplash</a></p>
<p>I recently had the chance to get familiar with CommandBox while I was updating my blog. My <a href="https://kisdigital.com/post/how-i-use-commandbox-with-my-blog">last post</a> outlined how I used CommandBox to allow me to manage my blog from the command line. I enjoyed that experience so I thought I would work with CommandBox once again.</p>
<p>Last year I wrote a static site generator called Jasper. So far I have built Jasper using <a href="https://github.com/robertz/jasper">ColdBox</a> as well as <a href="https://github.com/robertz/jasper-fw1">FW1</a>. I am going to take things one step further and I will implement Jasper as a <a href="https://github.com/robertz/commandbox-jasper">CommandBox module</a>. Apparently I really enjoy writing SSGs.</p>
<p>I decided to split the project in to two main parts: the jasper-cli blog scaffold and the <code>jasper</code> command that handles generating the static site.</p>
<h3>The blog scaffold</h3>
<p>The <a href="https://github.com/robertz/jasper-cli">jasper blog scaffold</a> contains a very basic blog.</p>
<ul>
<li><strong>jasperconfig.json</strong> - This is the configuration file used by <code>jasper</code>. It is expected to be in the root directory and must exist.</li>
<li><strong>assets/</strong> - The contents of this folder will be copied to the <code>dist/</code> folder at build time (wip)</li>
<li><strong>dist/</strong> - Generated pages will be here</li>
<li><strong>src/</strong> - The different pages that make up the contents</li>
<li><strong>src/layout/</strong> - Page header and footer</li>
<li><strong>src/posts/</strong> - The mardown files go here</li>
</ul>
<p>The &quot;guts&quot; of the skeleton app are in the <code>/src</code> folder and contains all the ColdFusion files required to render a blog page.</p>
<ul>
<li><strong>index.cfm</strong> - This is the page used to generate the home page</li>
<li><strong>post.cfm</strong> - This page is used to generate blog posts</li>
<li><strong>tags.cfm</strong> - Generates a list of posts associated with the given tag</li>
<li><strong>sidebar.cfm</strong> - Generate additional content to display on the page</li>
</ul>
<p>The markdown for posts are stored in <code>src/posts/</code> and the current base template contains two posts.</p>
<p>All data required to render the page is expected to be in the <code>prc</code> variable structure, the same as a ColdBox applicatiop. As an added benefit, the pages were already setup that way.</p>
<p><img src="https://static.kisdigital.com/images/2022/07/jasper-01.jpg" alt="jasper-cli" /></p>
<h3>jasper: the command</h3>
<p>The blog scaffold in place, next I need to actually be able to produce an HTML site from the <code>src/</code> contents. The commandbox-jasper module makes this possible and it is very easy to install.</p>
<p><code>box install commandbox-jasper</code></p>
<p>Once installed, from the root directory of the blog scaffold the static HTML can be created with <code>box jasper build</code>. This will build the all the individual pages for the site: the index, posts, as and finally posts by tag. It must be run from blog root directory.</p>
<p><img src="https://static.kisdigital.com/images/2022/07/jasper-02.jpg" alt="Generating a static site" /></p>
<p>Brad Wood gave me the tip that <code>including</code> a CFML in a <code>savecontent</code> block is the easiest way to render a CFML page. Once that was figured out, everything else just falls in place.</p>
<p>First, setup the faux <code>prc</code> scope and then include the page, save the generated html, and finally save teh file to the <code>dist/</code> directory.</p>
<p>Currently the build method handles writing out the three main page types: index, post, and tag.</p>
<pre><code class="language-javascript">component extends=&quot;commandbox.system.BaseCommand&quot; {
 property name=&quot;JasperService&quot; inject=&quot;JasperService@commandbox-jasper&quot;;
 function run() {
  command( &quot;jasper cache build&quot; ).run();
  var conf = deserializeJSON( fileRead( fileSystemUtil.resolvePath( &quot;jasperconfig.json&quot; ), &quot;utf-8&quot; ) );
  var posts = deserializeJSON( fileRead( fileSystemUtil.resolvePath( &quot;post-cache.json&quot; ), &quot;utf-8&quot; ) );
  var tags = JasperService.getTags( posts );
  var html = &quot;&quot;;
  var prc = {
   &quot;meta&quot; : {},
   &quot;posts&quot; : posts,
   &quot;html&quot; : &quot;&quot;,
   &quot;tagCloud&quot; : JasperService.getTags( posts )
  };
  prc.meta.append( conf.meta );
  // get the home page
  savecontent variable=&quot;html&quot; {
   include fileSystemUtil.resolvePath( &quot;src/index.cfm&quot; );
  }
  fileWrite( fileSystemUtil.resolvePath( &quot;dist/index.html&quot; ), html );
  // Build all posts
  var files = JasperService.list( path = fileSystemUtil.resolvePath( &quot;src/posts&quot; ) );
  files.each( ( file ) =&gt; {
   print.line( &quot;Generating... dist/post/&quot; &amp; file.name.listFirst( &quot;.&quot; ) &amp; &quot;.html&quot; );
   var html = &quot;&quot;;
   var prc = {
    &quot;meta&quot; : {},
    &quot;post&quot; : {},
    &quot;html&quot; : &quot;&quot;,
    &quot;tagCloud&quot; : tags
   };
   prc.meta.append( conf.meta );
   prc.post.append(
    JasperService.getPostData( fname = fileSystemUtil.resolvePath( &quot;src/posts/&quot; &amp; file.name ) )
   );
   prc.meta.title &amp;= &quot; - &quot; &amp; prc.post.title;
   savecontent variable=&quot;html&quot; {
    include fileSystemUtil.resolvePath( &quot;src/post.cfm&quot; );
   }
   fileWrite( fileSystemUtil.resolvePath( &quot;dist/post/&quot; &amp; prc.post.slug &amp; &quot;.html&quot; ), html );
  } );
  // build tags
  tags.each( ( tag ) =&gt; {
   print.line( &quot;Generating... dist/tag/&quot; &amp; lCase( tag ).replace( &quot; &quot;, &quot;-&quot;, &quot;all&quot; ) &amp; &quot;.html&quot; );
   var html = &quot;&quot;;
   var prc = {
    &quot;meta&quot; : {},
    &quot;tag&quot; : lCase( tag ),
    &quot;posts&quot; : [],
    &quot;html&quot; : &quot;&quot;,
    &quot;tagCloud&quot; : tags
   };
   prc.meta.append( conf.meta );
   prc.posts = posts.filter( ( post ) =&gt; {
    return post.tags.findNoCase( prc.tag );
   } );
   prc.meta.title &amp;= &quot; - &quot; &amp; lCase( prc.tag );
   savecontent variable=&quot;html&quot; {
    include fileSystemUtil.resolvePath( &quot;src/tags.cfm&quot; );
   }
   fileWrite( fileSystemUtil.resolvePath( &quot;dist/tag/&quot; &amp; tag.replace( &quot; &quot;, &quot;-&quot;, &quot;all&quot; ) &amp; &quot;.html&quot; ), html );
  } )
 }
}
</code></pre>
<p>Once the static site is built it can be served up using <code>netlify</code> or with your favorite http server.</p>
<p>There is still quite a bit to be ironed out before it is usable. OpenGraph/Twitter meta data is not currently working on posts which should be easy to fix. Error handling is non-existant, but the code functions well enough it does not error out most of the time. Currently the pages are built manually instead of dynamically from <code>jasperconfig.json</code>. All that will come.</p>
<h3>In Closing</h3>
<p>This was a fun project that let me work with a lot of my favorite stuff: ColdFusion, CommandBox, blogs, and markdown. I look forward to playing around with this a lot more.</p>
<p>This also makes it very easy to get started with your own CF static site.</p>
<pre><code class="language-bash">git clone https://github.com/robertz/jasper-cli.git
cd jasper-cli
box install commandbox-jasper
box jasper build
cd dist
netlify dev
</code></pre>
<p>Done.</p>
				</div>
<div id="disqus_thread"></div>
<script>
	/**
	 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
	 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
	var disqus_config = function () {
		this.page.url = "https://kisdigital.com/posts/2022/commandbox-jasper-ssg-generator";
		this.page.identifier = "/posts/2022/commandbox-jasper-ssg-generator"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
	};
	(function() { // DON'T EDIT BELOW THIS LINE
		var d = document, s = d.createElement('script');
		s.src = 'https://kisdigital.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			</div>
		</div>
	</div>
	<div class="col-lg-4 d-none d-lg-block d-xl-block">
<div>
	<div class="card rf-card-bordered text-white">
		<div class="card-body">
			<div class="card-title">
				<span class="h6"><span style="color: var(--post-link-text)">KIS</span>Digital</span>
			</div>
			<div class="card-text">
				<small>
					ColdFusion, ColdBox, CommandBox and assorted musings.
				</small>
			</div>
		</div>
	</div>
	<div class="card rf-card-bordered text-white mt-3">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">Tags</span>
			</div>
			<div class="card-text">
					<a href="/tag/cfml"> <span class="h5"><span class="badge bg-info text-muted p-2">cfml</span></span></a>
					<a href="/tag/commandbox"> <span class="h5"><span class="badge bg-info text-muted p-2">commandbox</span></span></a>
					<a href="/tag/misc"> <span class="h5"><span class="badge bg-info text-muted p-2">misc</span></span></a>
					<a href="/tag/sql"> <span class="h5"><span class="badge bg-info text-muted p-2">sql</span></span></a>
			</div>
		</div>
	</div>
	<div class="card rf-card-bordered text-white mt-3">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">Recent Posts</span>
			</div>
			<div class="card-text">
					<a href="/posts/2023/commandbox-ssg-updates" class="post-link text-decoration-none">Commandbox-ssg updates</a><br />
					<a href="/posts/2023/an-introduction-to-commandbox-ssg" class="post-link text-decoration-none">An introduction to commandbox-ssg</a><br />
					<a href="/posts/2023/bringing-back-commandbox-ssg" class="post-link text-decoration-none">Bringing back commandbox-ssg</a><br />
					<a href="/posts/2023/introducing-commandbox-apiman" class="post-link text-decoration-none">Introducing commandbox-apiman</a><br />
					<a href="/posts/2022/generating-common-blog-files-with-jasper" class="post-link text-decoration-none">Generating common blog files with Jasper</a><br />
			</div>
		</div>
	</div>
	<div class="card rf-card-bordered text-white mt-3">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">Projects</span>
			</div>
			<div class="card-text">
					<a href="/projects/commandbox-apiman" class="post-link text-decoration-none">commandbox-apiman</a><br />
					<a href="/projects/commandbox-ssg" class="post-link text-decoration-none">commandbox-ssg</a><br />
			</div>
		</div>
	</div>
</div>
	</div>
</div>
	</div>
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
	<script type="text/javascript" src="//cdn.jsdelivr.net/gh/dkern/jquery.lazy@1.7.10/jquery.lazy.min.js"></script>
	<script type="text/javascript" src="//cdn.jsdelivr.net/gh/dkern/jquery.lazy@1.7.10/jquery.lazy.plugins.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js" integrity="sha512-YBk7HhgDZvBxmtOfUdvX0z8IH2d10Hp3aEygaMNhtF8fSOvBZ16D/1bXZTJV6ndk/L/DlXxYStP8jrF77v2MIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="/assets/js/global.js?v=1703257225189"></script>
	<script>
		$(function($) {
			$('.lazy img').lazy()
		})
	</script>
</body>
</html>