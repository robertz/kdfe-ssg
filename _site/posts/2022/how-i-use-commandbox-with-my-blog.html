<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<title>KISDigital - How I use CommandBox with my blog</title>
	<meta name="description" content="ColdFusion, ColdBox, CommandBox and other assorted musings">
	<meta name="author" content="Robert Zehnder">
	<meta name="twitter:widgets:theme" content="light">
	<meta name="twitter:widgets:border-color" content="#55acee">
			<meta property="og:title" content="How I use CommandBox with my blog" />
			<meta property="og:description" content="CommandBox is not just for running servers" />
			<meta property="og:image" content="https://static.kisdigital.com/images/2022/06/commandbox.png" />
			<meta name="twitter:card" content="summary_large_image" />
			<meta name="twitter:title" content="How I use CommandBox with my blog" />
			<meta name="twitter:description" content="CommandBox is not just for running servers" />
			<meta name="twitter:image" content="https://static.kisdigital.com/images/2022/06/commandbox.png" />
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.3/font/bootstrap-icons.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism-themes/1.9.0/prism-one-dark.min.css" integrity="sha512-c6S8OdtvoqZCbMfA1lWE0qd368pLdFvVHVILQzNizfowC+zV8rmVKdSlmL5SuidvATO0A7awDg53axd+s/9amw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="/assets/css/site.css?v=1703108634386">
</head>
<body style="padding-top: 70px;">
	<header>
		<nav class="header">
			<div class="container">
				<div class="row">
					<div class="col-2">
						<a class="site-link" href="/"><span style="color: var(--post-link-text)">KIS</span>Digital</a>
					</div>
					<div class="col-10"></div>
				</div>
			</div>
		</nav>
	</header>
	<div class="container text-white">
<div class="row">
	<div class="col-lg-8 col-md-12">
		<div class="card rf-card-bordered">
			<div class="card-body">
				<div style="background: url(https://static.kisdigital.com/images/2022/06/commandbox.png) no-repeat center center; background-size: cover; height: 350px;">
					<div class="bg-dark w-75 opacity-75 p-2">
						<p class="h2 text-white">How I use CommandBox with my blog</p>
						<small class="d-block text-white py-1">CommandBox is not just for running servers</small>
							<span class="badge bg-light m-1 p-2 h5 text-dark">commandbox</span>
							<span class="badge bg-light m-1 p-2 h5 text-dark">cfml</span>
						<p class="text-white small text-uppercase">
							June 22, 2022 /
							Robert Zehnder
						</p>
					</div>
				</div>
				<div class="my-3">
					<a href="https://www.facebook.com/sharer/sharer.php?u=https://kisdigital.com/posts/2022/how-i-use-commandbox-with-my-blog" class="text-decoration-none" target="_blank">
						<i class="bi bi-facebook px-1 text-white fs-5"></i>
					</a>
					<a href="https://www.twitter.com/share?url=https://kisdigital.com/posts/2022/how-i-use-commandbox-with-my-blog" class="text-decoration-none" target="_blank">
						<i class="bi bi-twitter px-1 text-white fs-5"></i>
					</a>
					<a href="https://www.linkedin.com/sharing/share-offsite/?url=https://kisdigital.com/posts/2022/how-i-use-commandbox-with-my-blog" class="text-decoration-none" target="_blank">
						<i class="bi bi-linkedin px-1 text-white fs-5"></i>
					</a>
				</div>
				<div class="my-3 text-white decorate-links post">
					<p>Over the course of the last year my blog has been through many revamps and rewrites. I wrote a CF static site generator called Jasper that manages content by dropping markdown files into the <code>/posts</code> folder, dynamically generating a static site that can be deployed anywhere. The current iteration of the blog is running Jasper as a server; Instead of reading markdown files, posts are returned from a database.</p>
<p>The system works well, but the one downside to using a database how to manage the posts. I did not want to write an admin interface, I would prefer to manage it like it is a static site generator. The posts will be saved in the database, but I can retrieve a post and save it as a markdown file for editing and posted back to the server when done. As a matter of fact, I am editing <em>this</em> post in vscode.</p>
<p>I thought about how I would implement something like that. As it turns out, it was much easier than I expected.</p>
<h3>CommandBox to the rescue</h3>
<p>CommandBox is the ColdFusion developer's Swiss army knife. Not only does it run servers for you, you can also write modules you can execute through the cli. Here I will leverage the ability to write these modules to create <code>blog</code> commands that will allow me to interact with my site.</p>
<p>The first command is <code>blog list</code>. This command will output a list of posts and some details using the table printer. As you can see it is just a simple <code>cfhttp</code> call.</p>
<h5>/command/blog/list.cfc</h5>
<pre><code class="language-javascript">component extends=&quot;commandbox.system.BaseCommand&quot; {
 function run() {
  cfhttp( url = &quot;https://kisdigital.com/api/posts&quot;, timeout = &quot;60&quot; );
  var data = deserializeJSON( cfhttp.fileContent );
  print.table( data = data );
 }
}
</code></pre>
<p>This is what the finished result looks like.</p>
<p><img src="https://static.kisdigital.com/images/2022/06/blog-list.jpg" alt="List of posts" /></p>
<p>Next <code>blog get post post-slug</code> will get single post back. The front matter is all the keys returned from the api, minus <code>body</code> and <code>status</code>. The front matter is at the top of the file and the markdown follows and is written to a file named based on the slug. I can now edit locally and make whatever changes are required.</p>
<h5>/command/blog/get/post</h5>
<pre><code class="language-javascript">component extends=&quot;commandbox.system.BaseCommand&quot; output=false {
 function run( required string slug ) {
  var out = [];
  cfhttp( url = &quot;https://kisdigital.com/api/post/slug/&quot; &amp; slug, timeout = &quot;60&quot; );
  var data = deserializeJSON( cfhttp.fileContent );
  var frontMatter = &quot;&quot;;
  var fileOut = fileSystemUtil.resolvePath( arguments.slug &amp; &quot;.md&quot; );
  savecontent variable=&quot;frontMatter&quot; {
   writeOutput( &quot;---#chr( 10 )#&quot; );
   keys = data
    .keyArray()
    .filter( ( item ) =&gt; {
     // these keys should not be in the front matter
     return !( item == &quot;status&quot; || item == &quot;body&quot; );
    } );
   for ( var key in keys ) {
    writeOutput( key &amp; &quot;: &quot; &amp; data[ key ] &amp; chr( 10 ) );
   }
   writeOutput( &quot;---#chr( 10 )#&quot; );
  }
  fileWrite( fileOut, ( frontMatter &amp; data.body ) );
  print.line( &quot;File output to: &quot; &amp; fileOut );
 }
}
</code></pre>
<p>This is an example of what the generated markdown file would look like.</p>
<pre><code class="language-md">---
slug: my-awesome-post
title: This is a completely awesome post
description: It is almost scary it is so awesome
tags: code,cats,awesome
---
### My awesome post
</code></pre>
<p>Finally, <code>blog put post post-slug</code> will write a post to the database. The frontmatter is read from the post using the <a href="https://github.com/coldbox-modules/cbyaml">cbyaml</a> ColdBox module and added to the payload along with the body and posted to the api using <code>cfhttp</code>.</p>
<h5>/command/blog/put/post</h5>
<pre><code class="language-javascript">component extends=&quot;commandbox.system.BaseCommand&quot; output=false {
 property name=&quot;YamlService&quot; inject=&quot;Parser@cbyaml&quot;;
 function run( required string slug ) {
  var yaml = &quot;&quot;;
  var body = &quot;&quot;;
  if ( fileExists( fileSystemUtil.resolvePath( arguments.slug &amp; &quot;.md&quot; ) ) ) {
   var openFile = fileOpen( fileSystemUtil.resolvePath( arguments.slug &amp; &quot;.md&quot; ), &quot;read&quot; );
   var lines = [];
   try {
    while ( !fileIsEOF( openFile ) ) {
     arrayAppend( lines, fileReadLine( openFile ) );
    }
   } catch ( any e ) {
    rethrow;
   } finally {
    fileClose( openFile );
   }
   var fme = lines.findAll( &quot;---&quot; )[ 2 ]; // front matter end
   for ( var i = 2; i &lt; fme; i++ ) {
    yaml &amp;= lines[ i ] &amp; chr( 10 );
   }
   lines.each( ( line, index ) =&gt; {
    if ( index &gt; fme ) body &amp;= lines[ index ] &amp; chr( 10 );
   } )
   var frontMatter = YamlService.deserialize( trim( yaml ) );
   var payload = {
    slug : frontMatter.slug,
    image : frontMatter.image,
    author : frontMatter.author,
    title : frontMatter.title,
    description : frontMatter.description,
    tags : frontMatter.tags,
    published : frontMatter.keyExists( &quot;published&quot; ) ? frontMatter.published : &quot;&quot;,
    body : body
   };
   cfhttp( url = &quot;https://kisdigital.com/api/post&quot;, method = &quot;POST&quot; ) {
    cfhttpparam(
     type = &quot;header&quot;,
     name = &quot;content-type&quot;,
     value = &quot;application/json&quot;
    );
    cfhttpparam( type = &quot;body&quot;, value = serializeJSON( payload ) );
   }
  }
 }
}
</code></pre>
<p>I have written a new post, time to release it to the masses!</p>
<p><img src="https://static.kisdigital.com/images/2022/06/commandbox-blog-put.jpg" alt="blog post put" /></p>
<h3>In closing</h3>
<p>Honestly this is a use-case that probably only applies to me, but I thought it was pretty cool to be able to implement this with only a few lines of code. Being able to write ColdFusion code and run it from the command line is just freakin cool. Every time I look at the <a href="https://commandbox.ortusbooks.com/developing-for-commandbox">Developing for CommandBox</a> docs, I find something new I did not know it could do.</p>
<p>It is also very cool to be able to use existing ColdBox modules from a custom module. I spent a good bit of time getting the cbyaml module working when I could have just typed <code>box install cbyaml</code> and it would have just worked. It seems like common sense now, but I was overcomplicating things.</p>
<p>In closing, it is definitely worth your time getting familiar with CommandBox; It is not just for running development servers.</p>
				</div>
<div id="disqus_thread"></div>
<script>
	/**
	 *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
	 *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables    */
	var disqus_config = function () {
		this.page.url = "https://kisdigital.com/posts/2022/how-i-use-commandbox-with-my-blog";
		this.page.identifier = "/posts/2022/how-i-use-commandbox-with-my-blog"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
	};
	(function() { // DON'T EDIT BELOW THIS LINE
		var d = document, s = d.createElement('script');
		s.src = 'https://kisdigital.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
	})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
			</div>
		</div>
	</div>
	<div class="col-lg-4 d-none d-lg-block d-xl-block">
<div>
	<div class="card rf-card-bordered text-white">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">KISDigital</span>
			</div>
			<div class="card-text">
				<small>
					ColdFusion, ColdBox, CommandBox and assorted musings.
				</small>
			</div>
		</div>
	</div>
	<div class="card rf-card-bordered text-white mt-3">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">Tags</span>
			</div>
			<div class="card-text">
					<a href="/tag/misc"> <span class="h5"><span class="badge bg-info text-muted p-2">misc</span></span></a>
					<a href="/tag/cfml"> <span class="h5"><span class="badge bg-info text-muted p-2">cfml</span></span></a>
					<a href="/tag/commandbox"> <span class="h5"><span class="badge bg-info text-muted p-2">commandbox</span></span></a>
					<a href="/tag/sql"> <span class="h5"><span class="badge bg-info text-muted p-2">sql</span></span></a>
			</div>
		</div>
	</div>
	<div class="card rf-card-bordered text-white mt-3">
		<div class="card-body">
			<div class="card-title">
				<span class="h6">Recent Posts</span>
			</div>
			<div class="card-text">
					<a href="/posts/2023/merry-christmas-and-happy-new-year" class="post-link text-decoration-none">Wishing you a Merry Christmas</a><br />
					<a href="/posts/2023/commandbox-ssg-updates" class="post-link text-decoration-none">Commandbox-ssg updates</a><br />
					<a href="/posts/2023/an-introduction-to-commandbox-ssg" class="post-link text-decoration-none">An introduction to commandbox-ssg</a><br />
					<a href="/posts/2023/bringing-back-commandbox-ssg" class="post-link text-decoration-none">Bringing back commandbox-ssg</a><br />
					<a href="/posts/2023/introducing-commandbox-apiman" class="post-link text-decoration-none">Introducing commandbox-apiman</a><br />
			</div>
		</div>
	</div>
</div>
	</div>
</div>
	</div>
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
	<script type="text/javascript" src="//cdn.jsdelivr.net/gh/dkern/jquery.lazy@1.7.10/jquery.lazy.min.js"></script>
	<script type="text/javascript" src="//cdn.jsdelivr.net/gh/dkern/jquery.lazy@1.7.10/jquery.lazy.plugins.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/prism.min.js" integrity="sha512-YBk7HhgDZvBxmtOfUdvX0z8IH2d10Hp3aEygaMNhtF8fSOvBZ16D/1bXZTJV6ndk/L/DlXxYStP8jrF77v2MIg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="/assets/js/global.js?v=1703108634386"></script>
	<script>
		$(function($) {
			$('.lazy img').lazy()
		})
	</script>
</body>
</html>